<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ»‘åŠ¨è§†é¢‘æ’­æ”¾å™¨</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; overflow: hidden; background: #000; }
        
        /* å¼€å§‹å±å¹• */
        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            color: white;
            text-align: center;
            padding: 20px;
        }
        
        .start-button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            border-radius: 25px;
            cursor: pointer;
            margin-top: 20px;
            transition: transform 0.2s;
        }
        
        .start-button:hover { transform: scale(1.05); }
        
        .url-display {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.5);
            color: #888;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 1000;
            font-family: monospace;
        }
        
        /* ä¸»å®¹å™¨ */
        .container { 
            height: 100vh; 
            overflow-y: scroll; 
            scroll-behavior: smooth; 
            scroll-snap-type: y mandatory; 
        }
        
        .section { 
            height: 100vh; 
            scroll-snap-align: start; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
        }
        
        video { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            cursor: pointer;
        }
        
        /* éŸ³é‡æŒ‰é’® */
        .sound-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.5);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 1000;
            font-size: 20px;
        }
    </style>
</head>
<body>

    <!-- å¼€å§‹å±å¹• -->
    <div class="start-screen" id="startScreen">
        <h2>ğŸ“± æ»‘åŠ¨è§†é¢‘æ’­æ”¾å™¨</h2>
        <p style="margin: 20px 0;">åœ¨æ‰‹æœºä¸Šæ‰“å¼€æ­¤é¡µé¢ï¼š</p>
        <div id="deviceInfo" style="background:rgba(255,255,255,0.1); padding:15px; border-radius:10px; font-family:monospace;">
            æ­£åœ¨è·å–è®¿é—®åœ°å€...
        </div>
        <p style="margin-top: 20px; color: #888;">ç¡®ä¿æ‰‹æœºå’Œç”µè„‘åœ¨åŒä¸€Wi-Fiç½‘ç»œ</p>
        <button class="start-button" id="startButton">â–¶ å¼€å§‹æ’­æ”¾</button>
    </div>
    
    <!-- éŸ³é‡æŒ‰é’® -->
    <div class="sound-btn" id="soundBtn">ğŸ”‡</div>
    
    <!-- æ˜¾ç¤ºè®¿é—®åœ°å€ -->
    <div class="url-display" id="urlDisplay"></div>

    <div class="container" id="container">
        <!-- è§†é¢‘åˆ—è¡¨ -->
        <div class="section"><video id="video1" src="1.mp4" muted playsinline loop></video></div>
        <div class="section"><video id="video2" src="2.mp4" muted playsinline loop></video></div>
        <div class="section"><video id="video3" src="3.mp4" muted playsinline loop></video></div>
    </div>

    <script>
        const startScreen = document.getElementById('startScreen');
        const startButton = document.getElementById('startButton');
        const deviceInfo = document.getElementById('deviceInfo');
        const urlDisplay = document.getElementById('urlDisplay');
        const videos = [
            document.getElementById('video1'),
            document.getElementById('video2'),
            document.getElementById('video3')
        ];
        
        const container = document.getElementById('container');
        const soundBtn = document.getElementById('soundBtn');
        
        let currentIndex = 0;
        let isMuted = true;
        let isStarted = false;
        
        // è·å–è®¾å¤‡ä¿¡æ¯å’ŒIP
        async function getNetworkInfo() {
            try {
                // è·å–æœ¬æœºIP
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                
                // è·å–å±€åŸŸç½‘IP
                const localIP = await getLocalIP();
                
                // æ˜¾ç¤ºè®¿é—®ä¿¡æ¯
                deviceInfo.innerHTML = `
                    <div style="text-align:left;">
                        <div>å±€åŸŸç½‘è®¿é—®ï¼š<br><strong>http://${localIP}:8000</strong></div>
                        <div style="margin-top:10px; color:#aaa;">å…¬ç½‘IPï¼š${data.ip}</div>
                    </div>
                `;
                
                urlDisplay.textContent = `è®¿é—®åœ°å€ï¼šhttp://${localIP}:8000`;
                
            } catch (error) {
                deviceInfo.innerHTML = `
                    <div style="color:#ff6b6b;">
                        æ— æ³•è·å–IPåœ°å€<br>
                        åœ¨ç”µè„‘ç»ˆç«¯è¿è¡Œï¼š<br>
                        <code>python3 -m http.server 8000</code>
                    </div>
                `;
            }
        }
        
        // è·å–å±€åŸŸç½‘IP
        async function getLocalIP() {
            return new Promise((resolve) => {
                const RTCPeerConnection = window.RTCPeerConnection || 
                    window.mozRTCPeerConnection || 
                    window.webkitRTCPeerConnection;
                
                if (!RTCPeerConnection) {
                    resolve('192.168.x.x'); // é»˜è®¤
                    return;
                }
                
                const pc = new RTCPeerConnection({ iceServers: [] });
                pc.createDataChannel('');
                pc.createOffer().then(pc.setLocalDescription.bind(pc));
                
                pc.onicecandidate = (ice) => {
                    if (ice && ice.candidate && ice.candidate.candidate) {
                        const candidate = ice.candidate.candidate;
                        const match = candidate.match(/([0-9]{1,3}(\.[0-9]{1,3}){3})/);
                        if (match) {
                            resolve(match[1]);
                            pc.onicecandidate = () => {};
                            pc.close();
                        }
                    }
                };
                
                setTimeout(() => {
                    resolve('192.168.x.x');
                }, 1000);
            });
        }
        
        // 1. å¼€å§‹æŒ‰é’®ç‚¹å‡»
        startButton.addEventListener('click', () => {
            startScreen.style.display = 'none';
            urlDisplay.style.display = 'none';
            isStarted = true;
            
            // æ’­æ”¾ç¬¬ä¸€ä¸ªè§†é¢‘
            if (videos[0]) {
                videos[0].play().catch(e => {
                    console.log('è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢');
                });
            }
            
            // å»¶è¿Ÿå¼€å¯å£°éŸ³
            setTimeout(() => {
                isMuted = false;
                videos.forEach(v => v.muted = false);
                soundBtn.textContent = 'ğŸ”Š';
            }, 300);
        });
        
        // 2. æ»šåŠ¨åˆ‡æ¢
        container.addEventListener('scroll', () => {
            if (!isStarted) return;
            
            const scrollTop = container.scrollTop;
            const sectionHeight = window.innerHeight;
            const newIndex = Math.round(scrollTop / sectionHeight);
            
            if (newIndex !== currentIndex && newIndex < videos.length) {
                if (videos[currentIndex]) {
                    videos[currentIndex].pause();
                }
                
                currentIndex = newIndex;
                if (videos[currentIndex]) {
                    videos[currentIndex].play().catch(e => {
                        console.log('æ»šåŠ¨æ’­æ”¾è¢«é˜»æ­¢');
                    });
                }
            }
        });
        
        // 3. ç‚¹å‡»è§†é¢‘æ§åˆ¶
        videos.forEach(video => {
            video.addEventListener('click', function() {
                if (!isStarted) {
                    startButton.click();
                    return;
                }
                
                if (this.paused) {
                    this.play();
                } else {
                    this.pause();
                }
            });
        });
        
        // 4. éŸ³é‡æ§åˆ¶
        soundBtn.addEventListener('click', () => {
            isMuted = !isMuted;
            videos.forEach(v => v.muted = isMuted);
            soundBtn.textContent = isMuted ? 'ğŸ”‡' : 'ğŸ”Š';
        });
        
        // é¡µé¢åŠ è½½
        window.addEventListener('load', () => {
            getNetworkInfo();
            
            // éšè—URLæ˜¾ç¤º
            setTimeout(() => {
                urlDisplay.style.opacity = '0.5';
            }, 3000);
        });
    </script>
</body>
</html>
